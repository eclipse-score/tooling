# S-CORE Python Basics

**üéØ Zero-Boilerplate Python Setup for Bazel**

`score_python_basics` provides a complete Python development environment with **minimal configuration**. No more ~20 lines of manual `rules_python` setup!

## ‚ö° Quick Start

### For projects without pip dependencies (1 line!):
```starlark
# MODULE.bazel
bazel_dep(name = "score_python_basics", version = "0.3.0")
```

### For projects with pip dependencies (~6 lines):
```starlark
# MODULE.bazel  
bazel_dep(name = "score_python_basics", version = "0.3.0")

pip = use_extension("@rules_python//python/extensions:pip.bzl", "pip")
pip.parse(
    hub_name = "pip",
    python_version = "3.12", 
    requirements_lock = "//path/to:requirements.txt",
)
use_repo(pip, "pip")
```

**What you get automatically:**
- ‚úÖ `rules_python` (version 1.4.1) 
- ‚úÖ Python 3.12 toolchain configured as default
- ‚úÖ pytest testing framework
- ‚úÖ Python linting and formatting tools
- ‚úÖ Virtual environment support for IDEs

**No longer needed:**
```starlark
# ‚ùå Manual setup eliminated (~20 lines):
# bazel_dep(name = "rules_python", version = "1.4.1")
# python = use_extension("@rules_python//python/extensions:python.bzl", "python")
# python.toolchain(is_default = True, python_version = "3.12")
# use_repo(python)
```

## üìö Examples

See `/examples/` directory:
- `simple-python/` - Minimal setup (1 line in MODULE.bazel)
- `with-pip-deps/` - Adding pip dependencies  
- Comprehensive migration guide in `MIGRATION.md`

* ‚úÖ Makes development of Python code easier inside Bazel
* ‚úÖ Provides a Python virtualenv target
* ‚úÖ Provides S-CORE wide defaults for linting and formatting
* ‚úÖ Provides pytest with S-CORE wide defaults for pytest

## How To: Integrate

**üéØ Simple Setup - No More Boilerplate!**

`score_python_basics` automatically provides Python toolchain setup, eliminating the need for manual `rules_python` configuration.

### For projects without pip dependencies:
```starlark
# MODULE.bazel
bazel_dep(name = "score_python_basics", version = "0.3.0")
```

That's it! You get:
- ‚úÖ `rules_python` (version 1.4.1) automatically included
- ‚úÖ Python 3.12 toolchain configured as default  
- ‚úÖ Python development tools (pytest, linting, formatting)

### For projects with pip dependencies:
```starlark
# MODULE.bazel
bazel_dep(name = "score_python_basics", version = "0.3.0")

# Add your pip dependencies (Python 3.12 toolchain already configured)
pip = use_extension("@rules_python//python/extensions:pip.bzl", "pip")
pip.parse(
    hub_name = "pip",
    python_version = "3.12",  # Must match score_python_basics
    requirements_lock = "//path/to:requirements.txt",
)
use_repo(pip, "pip")
```

**üö´ No longer needed:** The old ~20-line boilerplate is eliminated:
```starlark
# ‚ùå This manual setup is no longer required:
# bazel_dep(name = "rules_python", version = "1.4.1")
# python = use_extension("@rules_python//python/extensions:python.bzl", "python") 
# python.toolchain(is_default = True, python_version = "3.12")
# use_repo(python)
```

## Python Virtualenv
The `score_virtualenv` rule creates a virtualenv for your IDE (syntax highlighting, formatting, linting etc).

```python
load("@score_python_basics//:defs.bzl", "score_virtualenv")

score_virtualenv(
    # optional: change target name
    name = "ide_support",

    # optional: change generated venv name
    venv_name = ".venv",

    # optional: add your own requirements
    # e.g. all_requirements comming from your pip installation via '@pip...
    reqs = []
)
```

You can create the virtualenv via the name you have defined above, e.g. `bazel
run //:ide_support`.

## Pytest

The `score_py_pytest` rule creates a pytest target.

*Note: the pytest version is determined by the `score_python_basics` module. It is intentionally not possible to overwrite it.*

```python
load("@score_python_basics//:defs.bzl", "score_py_pytest")

score_py_pytest(
    name = "test_my_first_check",
    srcs = [
        "test_my_first_check.py"
    ],
    plugins = [
        # Optionally specify pytest plugins, that will register their fixtures
    ],
    args = [
        # Specify optional arguments, ex:
        "--basetemp /tmp/pytest",
    ],
    # Optionally provide pytest.ini file, that will override the default one
    pytest_ini = "//my_pytest:my_pytest_ini",

    # Optionally provide tags the test should have, in order to allow for execution grouping
    tags = ["integration", #...]
)
```

## Basedpyright

Basedpyright provides enhanced type checking and Pylance features for Python development. It's included as part of the `score_python_basics` package.

*Note: The `basedpyright` version is determined by the `score_python_basics` module's dependencies (see `requirements.txt`).*

### IDE Integration (VS Code)

To enable Basedpyright in your VS Code editor:

1.  **Ensure the virtual environment is active:** Make sure you have created and selected the Python interpreter from the virtual environment generated by `score_virtualenv` (see [Python Virtualenv](#python-virtualenv) section and [Development setup](#setting-up-the-development-environment)).

2.  **Install the extension:** Add the `detachhead.basedpyright` extension to your `.vscode/extensions.json` file:

    ```json
    {
        "recommendations": [
            // ... other extensions
            "detachhead.basedpyright"
        ]
    }
    ```

3.  Define a root `pyproject.toml` that includes:
    ```toml
    [tool.basedpyright]
    extends = "bazel-bin/ide_support.runfiles/score_python_basics~/pyproject.toml"
    
    exclude = [
        "**/__pycache__",
        "**/.*",
        "**/bazel-*",
    ]
    ```

4.  **Reload VS Code:** Reload the window to activate the extension. Basedpyright will automatically use the selected Python interpreter from your virtual environment for type checking.

## Development of score_python_basics

### Setting up the development environment
To set up the development environment, you need to create a python virtual
environment:
```bash
bazel run private:ide_support
```

*Note: for now the virtualenv is created in the `python_basics` directory. VS
Code will not detect it automatically. You need to set the interpreter
(`python_basics/.venv/bin/python`) manually via ctrl+shift+p and "Python: Select
Interpreter".*


### Updating pytest in score_python_basics
It uses the dependencies from `requirements.txt`.  
If you have added new dependencies, make sure to update the *requirements.txt* file like so: 
```
# Add new dependencies:
bazel run //private:requirements.update

# Upgrade all dependencies:
bazel run //private:requirements.update -- --upgrade
```

### Running tests
To run the tests of the pytest module use:
```
$ bazel test //...
```
